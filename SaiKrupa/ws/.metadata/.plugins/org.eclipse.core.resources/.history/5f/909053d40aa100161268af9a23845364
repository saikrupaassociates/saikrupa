package com.saikrupa.app.service.report.impl;

import java.util.List;

import com.itextpdf.text.BaseColor;
import com.itextpdf.text.Document;
import com.itextpdf.text.DocumentException;
import com.itextpdf.text.Element;
import com.itextpdf.text.pdf.PdfPTable;
import com.saikrupa.app.dto.OrderData;
import com.saikrupa.app.service.report.common.CellValueType;
import com.saikrupa.app.service.report.component.ReportTableDataCell;
import com.saikrupa.app.service.report.component.ReportTableHeaderCell;

public class CustomerOrderReportService extends AbstractReportService {
	
	private List<OrderData> orders;

	public CustomerOrderReportService(List<OrderData> orders) {
		setOrders(orders);
	}

	@Override
	public void createPageTableContent(Document document) throws DocumentException {
		PdfPTable table = new PdfPTable(7);
		table.setHorizontalAlignment(Element.ALIGN_LEFT);
		table.getDefaultCell().setBorder(2);

		table.getDefaultCell().setBackgroundColor(BaseColor.LIGHT_GRAY);
		table.setWidthPercentage(100F);
		ReportTableHeaderCell header_OrderNo = new ReportTableHeaderCell("Order Number");
		ReportTableHeaderCell header_OrderDate = new ReportTableHeaderCell("Order Date");
		ReportTableHeaderCell header_OrderBy = new ReportTableHeaderCell("Unit Price");
		ReportTableHeaderCell orderQuantity = new ReportTableHeaderCell("Ordered Quantity");
		ReportTableHeaderCell amount = new ReportTableHeaderCell("Order Amount");
		ReportTableHeaderCell paymentStatus = new ReportTableHeaderCell("Payment");
		ReportTableHeaderCell deliveryStatus = new ReportTableHeaderCell("Delivery");
		
		table.addCell(header_OrderNo);
		table.addCell(header_OrderDate);
		table.addCell(header_OrderBy);
		table.addCell(amount);
		table.addCell(orderQuantity);
		table.addCell(paymentStatus);
		table.addCell(deliveryStatus);
		
		for(OrderData data : getOrders()) {
			ReportTableDataCell data_OrderNo = new ReportTableDataCell(String.valueOf(data.getCode()), CellValueType.TEXT);
			ReportTableDataCell data_OrderDate = new ReportTableDataCell(data.getCreatedDate(), CellValueType.DATE);
			ReportTableDataCell data_OrderedBy = new ReportTableDataCell(data.getOrderEntries().get(0).getPrice(), CellValueType.AMOUNT);
			ReportTableDataCell data_amount = new ReportTableDataCell(data.getTotalPrice(), CellValueType.AMOUNT);
			ReportTableDataCell data_quantity = new ReportTableDataCell(Double.valueOf(data.getOrderEntries().get(0).getOrderedQuantity()), CellValueType.QUANTITY);
			ReportTableDataCell data_paymentStatus = new ReportTableDataCell(data.getPaymentStatus().toString(), CellValueType.TEXT);
			ReportTableDataCell data_deliveryStatus = new ReportTableDataCell(data.getDeliveryStatus().toString(), CellValueType.TEXT);
			
			table.addCell(data_OrderNo);
			table.addCell(data_OrderDate);
			table.addCell(data_OrderedBy);
			table.addCell(data_amount);
			table.addCell(data_quantity);
			table.addCell(data_paymentStatus);
			table.addCell(data_deliveryStatus);
		}
		document.add(table);
	}

	@Override
	public void addMetaData(Document document) {
		document.addTitle("Consolidated Order Report By Customer");
		
	}

	@Override
	public String getPageTitle() {
		return "Order Report By Customer - "+getOrders().get(0).getCustomer().getName();
	}

	public List<OrderData> getOrders() {
		return orders;
	}

	public void setOrders(List<OrderData> orders) {
		this.orders = orders;
	}

	@Override
	public void consolidate(Document document) throws DocumentException {
		PdfPTable table = new PdfPTable(2);
		table.setHorizontalAlignment(Element.ALIGN_LEFT);
		table.getDefaultCell().setBorder(2);
		table.getDefaultCell().setBackgroundColor(BaseColor.LIGHT_GRAY);
		table.setWidthPercentage(100F);
		ReportTableHeaderCell TotalOrderValue = new ReportTableHeaderCell("Total Order Amount");
		table.completeRow();
		
		ReportTableHeaderCell header_OrderDate = new ReportTableHeaderCell("Total Paid Amount");
		table.completeRow();
	}

}
